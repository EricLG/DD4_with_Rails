<%# Sidebloc content%>
<% content_for :sidebloc do %>
    <%= render "sidebloc/character_creation" %>
<% end %>

<div class="row">
  <h3 class="col-sm-12"><%= t('characters.title_new')%></h3>
</div>
<br>

<div class="row">
  <div class="col-sm-8">
    <%= form_for @character, url: character_choose_feats_path(@character.id), html: {class: 'form-horizontal'} do |f| %>
    <%= f.fields_for :formations_choice, @character.formations_choice do |fc| %>
      <%= fc.hidden_field :origin, value: 'formations_choice' %>
      <div class="row">
        <h4>Choix des formations de compétences de classes - <small>EN COURS DE DÉVELOPPEMENT</small></h4>
        <p>Une formation vous donne un bonus de +5 à un test de compétence.<br>Sélectionnez <%= @character.klass.skills_number %> formations de compétence dans la liste suivante :</p>
        <% if @character.klass.name == 'Rôdeur'  %>
          <p>En tant que rôdeur, vous bénéficiez au choix d'Exploration ou de Nature.</p>
        <% end %>
        <div class="col-sm-12">

          <table class="table table-condensed">
            <thead>
              <tr>
                <th class="medium-width center">Bonus total</th>
                <th class="table-width center">Nom</th>
                <th class="small-width"></th>
                <th class="medium-width center">Carac</th>
                <th class="medium-width center">Carac + 1/2 niv.</th>
                <th class="medium-width center">Race</th>
                <th class="medium-width center">Formation</th>
              </tr>
            </thead>
            <tbody id="character-formation">
              <% @skills.each do |s, fr_skill| %>
                <% if @character.klass.available_skills.to_a.include?(s) %>
                    <%
                      link_carac = Skill.get_linked_carac(s)
                      racial_bonus = @character.race.skill.send(s)
                      carac_half_level = count_comp_bonus_carac_level(s, link_carac)
                      # TODO prendre en conmpte la formation
                      total_bonus = count_total_bonus_comp(carac_half_level, racial_bonus)
                    %>
                  <tr>
                    <td>
                      <button type="button" class="final-value btn btn-default max-width bold" disabled="disabled">
                        <%= total_bonus %>
                      </button>
                    </td>
                    <td class="center"><%= fr_skill %></td>
                    <td class="center"></td>
                    <td class="center"><%= Stat.human_attribute_name(link_carac) %></td>
                    <td>
                      <button type="button" class="mod-skill-half_lvl btn btn-default max-width bold" disabled="disabled">
                      <%= carac_half_level %>
                      </button>
                    </td>
                    <td>
                      <%= button_tag(racial_bonus, class: "center max-width btn btn-default", disabled: true) %></td>
                    </td>
                    <td class="center">
                      <% if @character.formations_choice && @character.formations_choice.send(s) == 5 %>
                        <button type="button" class="btn btn-default  btn-info btn-skill-bonus-formation">
                          <%= fc.hidden_field "#{s}", value: 5, disabled: false %>
                          <span class="glyphicon glyphicon-ok"></span>
                        </button>
                      <% else %>
                        <button type="button" class="btn btn-default btn-skill-bonus-formation">
                          <%= fc.hidden_field "#{s}", value: 5, disabled: true %>
                          <span class="glyphicon glyphicon-plus"></span>
                        </button>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
     <% end %>
      <%= link_to 'Précédent', character_choose_features_path(@character.id), class: "btn btn-default" %>
      <%= submit_text_form(f) %>
     <% end %>
  </div>
</div>
